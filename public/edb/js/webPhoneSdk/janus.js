function Janus(s){if(void 0===Janus.initDone)return s.error("Library not initialized"),{};if(!Janus.isWebrtcSupported())return s.error("WebRTC not supported by this browser"),{};if(Janus.log("Library initialized: "+Janus.initDone),(s=s||{}).success="function"==typeof s.success?s.success:Janus.noop,s.error="function"==typeof s.error?s.error:Janus.noop,s.destroyed="function"==typeof s.destroyed?s.destroyed:Janus.noop,null===s.server||void 0===s.server)return s.error("Invalid gateway url"),{};var i=!1,u=null,d={},c=null,o=null,l=0,f=s.server;Janus.isArray(f)?(Janus.log("Multiple servers provided ("+f.length+"), will use the first that works"),f=null,o=s.server,Janus.debug(o)):0===f.indexOf("ws")?(i=!0,Janus.log("Using WebSockets to contact Janus: "+f)):(i=!1,Janus.log("Using REST API to contact Janus: "+f));var g=s.iceServers;null==g&&(g=[{urls:"stun:stun.l.google.com:19302"}]);var p=s.iceTransportPolicy,v=s.bundlePolicy,m=s.ipv6;null==m&&(m=!1);var b=!1;void 0!==s.withCredentials&&null!==s.withCredentials&&(b=!0===s.withCredentials);var n=null;(n=void 0!==s.max_poll_events&&null!==s.max_poll_events?s.max_poll_events:n)<1&&(n=1);var J=null;void 0!==s.token&&null!==s.token&&(J=s.token);var w=null;void 0!==s.apisecret&&null!==s.apisecret&&(w=s.apisecret),this.destroyOnUnload=!0,void 0!==s.destroyOnUnload&&null!==s.destroyOnUnload&&(this.destroyOnUnload=!0===s.destroyOnUnload);var h=!1,y=null,S={},k=this,D=0,T={};function C(){var e;null!=y&&(Janus.debug("Long poll..."),h?(e=f+"/"+y+"?rid="+(new Date).getTime(),null!=n&&(e=e+"&maxev="+n),null!=J&&(e=e+"&token="+J),null!=w&&(e=e+"&apisecret="+w),Janus.httpAPICall(e,{verb:"GET",withCredentials:b,success:I,timeout:6e4,error:function(e,n){if(Janus.error(e+": "+n),3<++D)return h=!1,void s.error("Lost connection to the gateway (is it down?)");C()}})):Janus.warn("Is the gateway down? (connected=false)"))}function I(e,n){var r,a,t,o;if(D=0,i||null==y||!0===n||setTimeout(C,200),i||!Janus.isArray(e))"keepalive"===e.janus?Janus.vdebug("Got a keepalive on session "+y):"ack"===e.janus?(Janus.debug("Got an ack on session "+y),Janus.debug(e),null!=(a=e.transaction)&&(null!=(r=T[a])&&r(e),delete T[a])):"success"===e.janus?(Janus.debug("Got a success on session "+y),Janus.debug(e),null!=(a=e.transaction)&&(null!=(r=T[a])&&r(e),delete T[a])):"webrtcup"===e.janus?(Janus.debug("Got a webrtcup event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(o=S[t])?o.webrtcState(!0):Janus.debug("This handle is not attached to this session"):Janus.warn("Missing sender...")):"hangup"===e.janus?(Janus.debug("Got a hangup event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(o=S[t])?(o.webrtcState(!1,e.reason),o.hangup()):Janus.debug("This handle is not attached to this session"):Janus.warn("Missing sender...")):"detached"===e.janus?(Janus.debug("Got a detached event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(o=S[t])&&(o.detached=!0,o.ondetached(),o.detach()):Janus.warn("Missing sender...")):"media"===e.janus?(Janus.debug("Got a media event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(o=S[t])?o.mediaState(e.type,e.receiving):Janus.debug("This handle is not attached to this session"):Janus.warn("Missing sender...")):"slowlink"===e.janus?(Janus.debug("Got a slowlink event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(o=S[t])?o.slowLink(e.uplink,e.nacks):Janus.debug("This handle is not attached to this session"):Janus.warn("Missing sender...")):"error"===e.janus?(Janus.error("Ooops: "+e.error.code+" "+e.error.reason),Janus.debug(e),null!=(a=e.transaction)&&(null!=(r=T[a])&&r(e),delete T[a])):"event"===e.janus?(Janus.debug("Got a plugin event on session "+y),Janus.debug(e),null!=(t=e.sender)?null!=(a=e.plugindata)?(Janus.debug("  -- Event is coming from "+t+" ("+a.plugin+")"),a=a.data,Janus.debug(a),null!=(o=S[t])?(null!=(t=e.jsep)&&(Janus.debug("Handling SDP as well..."),Janus.debug(t)),null!=(o=o.onmessage)?(Janus.debug("Notifying application..."),o(a,t)):Janus.debug("No provided notification callback")):Janus.warn("This handle is not attached to this session")):Janus.warn("Missing plugindata..."):Janus.warn("Missing sender...")):(Janus.warn("Unkown message/event  '"+e.janus+"' on session "+y),Janus.debug(e));else for(var s=0;s<e.length;s++)I(e[s],!0)}function A(){var e;null!==f&&i&&h&&(c=setTimeout(A,3e4),e={janus:"keepalive",session_id:y,transaction:Janus.randomString(12)},null!=J&&(e.token=J),null!=w&&(e.apisecret=w),u.send(JSON.stringify(e)))}function t(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:Janus.noop,r.error="function"==typeof r.error?r.error:Janus.noop,!h)return Janus.warn("Is the gateway down? (connected=false)"),void r.error("Is the gateway down? (connected=false)");var n=r.message,a=r.jsep,t=Janus.randomString(12),n={janus:"message",body:n,transaction:t};if(null!=J&&(n.token=J),null!=w&&(n.apisecret=w),null!=a&&(n.jsep=a),Janus.debug("Sending message to plugin (handle="+e+"):"),Janus.debug(n),i)return n.session_id=y,n.handle_id=e,T[t]=function(e){if(Janus.debug("Message sent!"),Janus.debug(e),"success"===e.janus){var n=e.plugindata;if(null==n)return Janus.warn("Request succeeded, but missing plugindata..."),void r.success();Janus.log("Synchronous transaction successful ("+n.plugin+")");n=n.data;return Janus.debug(n),void r.success(n)}"ack"===e.janus?r.success():void 0!==e.error&&null!==e.error?(Janus.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(Janus.error("Unknown error"),r.error("Unknown error"))},void u.send(JSON.stringify(n));Janus.httpAPICall(f+"/"+y+"/"+e,{verb:"POST",withCredentials:b,body:n,success:function(e){if(Janus.debug("Message sent!"),Janus.debug(e),"success"===e.janus){var n=e.plugindata;if(null==n)return Janus.warn("Request succeeded, but missing plugindata..."),void r.success();Janus.log("Synchronous transaction successful ("+n.plugin+")");n=n.data;return Janus.debug(n),void r.success(n)}"ack"===e.janus?r.success():void 0!==e.error&&null!==e.error?(Janus.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(Janus.error("Unknown error"),r.error("Unknown error"))},error:function(e,n){Janus.error(e+": "+n),r.error(e+": "+n)}})}function R(e,n){if(h){n={janus:"trickle",candidate:n,transaction:Janus.randomString(12)};if(null!=J&&(n.token=J),null!=w&&(n.apisecret=w),Janus.vdebug("Sending trickle candidate (handle="+e+"):"),Janus.vdebug(n),i)return n.session_id=y,n.handle_id=e,void u.send(JSON.stringify(n));Janus.httpAPICall(f+"/"+y+"/"+e,{verb:"POST",withCredentials:b,body:n,success:function(e){Janus.vdebug("Candidate sent!"),Janus.vdebug(e),"ack"!==e.janus&&Janus.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,n){Janus.error(e+": "+n)}})}else Janus.warn("Is the gateway down? (connected=false)")}function x(e,n){(n=n||{}).success="function"==typeof n.success?n.success:Janus.noop,n.error="function"==typeof n.error?n.error:Janus.noop;var r=S[e];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return Janus.warn("Invalid handle"),void n.error("Invalid handle");e=r.webrtcStuff,r=n.text;if(null==r)return Janus.warn("Invalid text"),void n.error("Invalid text");Janus.log("Sending string on data channel: "+r),e.dataChannel.send(r),n.success()}function O(e,n){(n=n||{}).success="function"==typeof n.success?n.success:Janus.noop,n.error="function"==typeof n.error?n.error:Janus.noop;e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),void n.error("Invalid handle");e=e.webrtcStuff;if((null===e.dtmfSender||void 0===e.dtmfSender)&&(void 0===e.myStream||null===e.myStream||null!=(r=e.myStream.getAudioTracks())&&0<r.length&&(a=r[0],e.dtmfSender=e.pc.createDTMFSender(a),Janus.log("Created DTMF Sender"),e.dtmfSender.ontonechange=function(e){Janus.debug("Sent DTMF tone: "+e.tone)}),null===e.dtmfSender||void 0===e.dtmfSender))return Janus.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration");var r=n.dtmf;if(null==r)return Janus.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var a=r.tones;if(null==a)return Janus.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");n=r.duration;null==n&&(n=500);r=r.gap;null==r&&(r=50),Janus.debug("Sending DTMF string "+a+" (duration "+n+"ms, gap "+r+"ms)"),e.dtmfSender.insertDTMF(a,n,r)}function j(r,a){(a=a||{}).success="function"==typeof a.success?a.success:Janus.noop,a.error="function"==typeof a.error?a.error:Janus.noop,Janus.warn(a);var e=!0;if(void 0!==a.asyncRequest&&null!==a.asyncRequest&&(e=!0===a.asyncRequest),Janus.log("Destroying handle "+r+" (async="+e+")"),_(r),S[r].detached)return delete S[r],void a.success();if(!h)return Janus.warn("Is the gateway down? (connected=false)"),void a.error("Is the gateway down? (connected=false)");var n={janus:"detach",transaction:Janus.randomString(12)};if(null!=J&&(n.token=J),null!=w&&(n.apisecret=w),i)return n.session_id=y,n.handle_id=r,u.send(JSON.stringify(n)),delete S[r],void a.success();Janus.httpAPICall(f+"/"+y+"/"+r,{verb:"POST",async:e,withCredentials:b,body:n,success:function(e){Janus.log("Destroyed handle:"),Janus.debug(e),"success"!==e.janus&&Janus.error("Ooops: "+e.error.code+" "+e.error.reason),delete S[r],a.success()},error:function(e,n){Janus.error(e+": "+n),delete S[r],a.success()}})}function M(a,e,n,t,r){var o=S[a];if(null==o||null===o.webrtcStuff||void 0===o.webrtcStuff)return Janus.warn("Invalid handle"),void t.error("Invalid handle");var s=o.webrtcStuff;Janus.debug("streamsDone:",r),s.myStream=r;var i={iceServers:g,iceTransportPolicy:p,bundlePolicy:v},u={optional:[{DtlsSrtpKeyAgreement:!0}]};!0===m&&u.optional.push({googIPv6:!0}),"edge"===Janus.webRTCAdapter.browserDetails.browser&&(i.bundlePolicy="max-bundle"),Janus.log("Creating PeerConnection"),Janus.debug(u),s.pc=new RTCPeerConnection(i,u),Janus.debug(s.pc),s.pc.getStats&&(s.volume.value=0,s.bitrate.value="0 kbits/sec"),Janus.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&o.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(e){var n,r;null==e.candidate||"edge"===Janus.webRTCAdapter.browserDetails.browser&&0<e.candidate.candidate.indexOf("endOfCandidates")?(Janus.log("End of candidates."),(s.iceDone=!0)===s.trickle?R(a,{completed:!0}):(n=a,(r=(r=t)||{}).success="function"==typeof r.success?r.success:Janus.noop,r.error="function"==typeof r.error?r.error:Janus.noop,null==(n=S[n])||null===n.webrtcStuff||void 0===n.webrtcStuff?Janus.warn("Invalid handle, not sending anything"):(n=n.webrtcStuff,Janus.log("Sending offer/answer SDP..."),null===n.mySdp||void 0===n.mySdp?Janus.warn("Local SDP instance is invalid, not sending anything..."):(n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},n.sdpSent?Janus.log("Offer/Answer SDP already sent, not sending it again"):(!1===n.trickle&&(n.mySdp.trickle=!1),Janus.debug(r),n.sdpSent=!0,r.success(n.mySdp)))))):(e={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex},!0===s.trickle&&R(a,e))},null!=r&&(Janus.log("Adding local stream"),r.getTracks().forEach(e=>s.pc.addTrack(e,r)),o.onlocalstream(r)),s.pc.ontrack=function(e){Janus.log("Handling Remote Track"),Janus.debug(e),e.streams&&(s.remoteStream=e.streams[0],o.onremotestream(s.remoteStream))},u=n,Janus.debug("isDataEnabled:",u),("edge"!=Janus.webRTCAdapter.browserDetails.browser?null==u||!0!==u.data:(Janus.warn("Edge doesn't support data channels yet"),1))||(Janus.log("Creating data channel"),u=function(){var e=null!==s.dataChannel?s.dataChannel.readyState:"null";Janus.log("State change on data channel: "+e),"open"===e&&o.ondataopen()},s.dataChannel=s.pc.createDataChannel("JanusDataChannel",{ordered:!1}),s.dataChannel.onmessage=function(e){Janus.log("Received message on data channel: "+e.data),o.ondata(e.data)},s.dataChannel.onopen=u,s.dataChannel.onclose=u,s.dataChannel.onerror=function(e){Janus.error("Got error on data channel:",e)}),null==e?F(a,n,t):s.pc.setRemoteDescription(new RTCSessionDescription(e),function(){Janus.log("Remote description accepted!"),L(a,n,t)},t.error)}function P(s,i){(i=i||{}).success="function"==typeof i.success?i.success:Janus.noop,i.error="function"==typeof i.error?i.error:q;var u=i.jsep,d=i.media,c=S[s];if(null==c||null===c.webrtcStuff||void 0===c.webrtcStuff)return Janus.warn("Invalid handle"),void i.error("Invalid handle");var e,n=c.webrtcStuff;if(void 0!==n.pc&&null!==n.pc)return Janus.log("Updating existing media session"),void(null==u?F(s,d,i):n.pc.setRemoteDescription(new RTCSessionDescription(u),function(){Janus.log("Remote description accepted!"),L(s,d,i)},i.error));if(n.trickle=(e=i.trickle,Janus.debug("isTrickleEnabled:",e),null==e||!0===e),null!==i.stream&&void 0!==i.stream){var r=i.stream;return Janus.log("MediaStream provided by the application"),Janus.debug(r),n.streamExternal=!0,void M(s,u,d,i,r)}if(G(d)||H(d)){var a={mandatory:{},optional:[]};c.consentDialog(!0);var l=G(d);!0===l&&null!=d&&null!=d&&"object"==typeof d.audio&&(l=d.audio);var f=H(d);if(!0===f&&null!=d&&null!=d)if(!(!0===i.simulcast)||u||void 0!==d.video&&!1!==d.video||(d.video="hires"),d.video&&"screen"!=d.video&&"window"!=d.video){var t=0,o=0,r=0;"lowres"===d.video?(r=o=240,t=320):"lowres-16:9"===d.video?(r=o=180,t=320):"hires"===d.video||"hires-16:9"===d.video?(r=o=720,t=1280,navigator.mozGetUserMedia&&parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)<38&&(Janus.warn(d.video+" unsupported, falling back to stdres (old Firefox)"),r=o=480,t=640)):t=(r=o="stdres"===d.video?480:"stdres-16:9"===d.video?360:(Janus.log("Default video setting is stdres 4:3"),480),640),Janus.log("Adding media constraint:",d.video),f=navigator.mozGetUserMedia?parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)<38?{require:["height","width"],height:{max:r,min:o},width:{max:t,min:t}}:{height:{ideal:o},width:{ideal:t}}:{mandatory:{maxHeight:r,minHeight:o,maxWidth:t,minWidth:t},optional:[]},"object"==typeof d.video&&(f=d.video),Janus.debug(f)}else if("screen"===d.video||"window"===d.video){if(d.screenshareFrameRate||(d.screenshareFrameRate=3),"https:"!==window.location.protocol)return Janus.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),c.consentDialog(!1),void i.error("Screen sharing only works on HTTPS, try the https:// version of this page");var g={};function p(e,n){c.consentDialog(!1),e?i.error({code:e.code,name:e.name,message:e.message}):M(s,u,d,i,n)}function v(e,r,a){Janus.log("Adding media constraint (screen capture)"),Janus.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(n){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){n.addTrack(e.getAudioTracks()[0]),r(null,n)}):r(null,n)}).catch(function(e){c.consentDialog(!1),r(e)})}if("chrome"===Janus.webRTCAdapter.browserDetails.browser){o=Janus.webRTCAdapter.browserDetails.version,t=33;window.navigator.userAgent.match("Linux")&&(t=35),26<=o&&o<=t?v(a={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:d.screenshareFrameRate,maxFrameRate:d.screenshareFrameRate,chromeMediaSource:"screen"}},audio:G(d)},p):(t=window.setTimeout(function(){return(m=new Error("NavigatorUserMediaError")).name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',c.consentDialog(!1),i.error(m)},1e3),g[t]=[p,null],window.postMessage({type:"janusGetScreen",id:t},"*"))}else if(window.navigator.userAgent.match("Firefox")){if(!(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10))){var m=new Error("NavigatorUserMediaError");return m.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",c.consentDialog(!1),void i.error(m)}v(a={video:{mozMediaSource:d.video,mediaSource:d.video},audio:G(d)},function(e,n){var r,a;p(e,n),e||(r=n.currentTime,a=window.setInterval(function(){n||window.clearInterval(a),n.currentTime==r&&(window.clearInterval(a),n.onended&&n.onended()),r=n.currentTime},500))})}return void window.addEventListener("message",function(e){var n,r;e.origin==window.location.origin&&("janusGotScreen"==e.data.type&&g[e.data.id]?(n=g[e.data.id][0],delete g[e.data.id],""===e.data.sourceId?((r=new Error("NavigatorUserMediaError")).name="You cancelled the request for permission, giving up...",c.consentDialog(!1),i.error(r)):((a={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:d.screenshareFrameRate,maxFrameRate:d.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=e.data.sourceId,v(a,n,G(d)))):"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id))})}null!=d&&"screen"===d.video||navigator.mediaDevices.enumerateDevices().then(function(e){var n,r=e.some(function(e){return"audioinput"===e.kind}),a=e.some(function(e){return"videoinput"===e.kind}),t=G(d),o=H(d),e=(n=d,Janus.debug("isAudioSendRequired:",n),null!=n&&(!1!==n.audio&&!1!==n.audioSend&&(void 0!==n.failIfNoAudio&&null!==n.failIfNoAudio&&!0===n.failIfNoAudio))),n=(n=d,Janus.debug("isVideoSendRequired:",n),null!=n&&(!1!==n.video&&!1!==n.videoSend&&(void 0!==n.failIfNoVideo&&null!==n.failIfNoVideo&&!0===n.failIfNoVideo)));if(t||o||e||n){t=!!t&&r,o=!!o&&a;if(!t&&!o)return c.consentDialog(!1),i.error("No capture device found"),!1;if(!t&&e)return c.consentDialog(!1),i.error("Audio capture is required, but no capture device found"),!1;if(!o&&n)return c.consentDialog(!1),i.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!r&&l,video:!!a&&f}).then(function(e){c.consentDialog(!1),M(s,u,d,i,e)}).catch(function(e){c.consentDialog(!1),i.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){c.consentDialog(!1),i.error("enumerateDevices error",e)})}else M(s,u,d,i)}function E(e,n){(n=n||{}).success="function"==typeof n.success?n.success:Janus.noop,n.error="function"==typeof n.error?n.error:q;var r=n.jsep,e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),void n.error("Invalid handle");e=e.webrtcStuff;if(null!=r){if(null===e.pc)return Janus.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");e.pc.setRemoteDescription(new RTCSessionDescription(r),function(){Janus.log("Remote description accepted!"),n.success()},n.error)}else n.error("Invalid JSEP")}function F(e,n,r){(r=r||{}).success="function"==typeof r.success?r.success:Janus.noop,r.error="function"==typeof r.error?r.error:Janus.noop;var a=S[e];if(null==a||null===a.webrtcStuff||void 0===a.webrtcStuff)return Janus.warn("Invalid handle"),void r.error("Invalid handle");var t=a.webrtcStuff,o=!0===r.simulcast;o?Janus.log("Creating offer (iceDone="+t.iceDone+", simulcast="+o+")"):Janus.log("Creating offer (iceDone="+t.iceDone+")");e=null,e="firefox"==Janus.webRTCAdapter.browserDetails.browser||"edge"==Janus.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:B(n),offerToReceiveVideo:z(n)}:{mandatory:{OfferToReceiveAudio:B(n),OfferToReceiveVideo:z(n)}};Janus.debug(e);var s=H(n);s&&o&&"firefox"===adapter.browserDetails.browser&&(Janus.log("Enabling Simulcasting for Firefox (RID)"),a=t.pc.getSenders()[1],Janus.log(a),n=a.getParameters(),Janus.log(n),a.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})),t.pc.createOffer(function(e){Janus.debug(e),null!==t.mySdp&&void 0!==t.mySdp||(Janus.log("Setting local description"),s&&o&&("chrome"===adapter.browserDetails.browser?(Janus.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var n=e.split("\r\n"),r=!1,a=[-1],t=-1,o=null,s=null,i=null,u=null,d=-1,c=0;c<n.length;c++){var l=n[c].match(/m=(\w+) */);if(l){if("video"===l[1]){if(!(a[0]<0)){d=c;break}r=!0}else if(-1<a[0]){d=c;break}}else if(r){var f=n[c].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)a[0]=f[1],t=f[2],n.splice(c,1),c--;else{if(a[0]){if((g=n[c].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=g[1]),(g=n[c].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(s=g[1]),(g=n[c].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(i=g[1]),(g=n[c].match("a=ssrc:"+a+" label:(.+)"))&&(u=g[1]),0===n[c].indexOf("a=ssrc:"+t)){n.splice(c,1),c--;continue}if(0===n[c].indexOf("a=ssrc:"+a[0])){n.splice(c,1),c--;continue}}0!=n[c].length||(n.splice(c,1),c--)}}}if(a[0]<0){r=!(d=-1);for(c=0;c<n.length;c++){var g,l=n[c].match(/m=(\w+) */);if(l){if("video"===l[1]){if(!(a[0]<0)){d=c;break}r=!0}else if(-1<a[0]){d=c;break}}else if(r){if(a[0]<0){var p=n[c].match(/a=ssrc:(\d+)/);if(p){a[0]=p[1],n.splice(c,1),c--;continue}}else{if((g=n[c].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=g[1]),(g=n[c].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(s=g[1]),(g=n[c].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(i=g[1]),(g=n[c].match("a=ssrc:"+a+" label:(.+)"))&&(u=g[1]),0===n[c].indexOf("a=ssrc:"+t)){n.splice(c,1),c--;continue}if(0===n[c].indexOf("a=ssrc:"+a[0])){n.splice(c,1),c--;continue}}0!=n[c].length||(n.splice(c,1),c--)}}}if(a[0]<0)return Janus.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=n.length);a[1]=Math.floor(4294967295*Math.random()),a[2]=Math.floor(4294967295*Math.random());for(c=0;c<a.length;c++)o&&(n.splice(d,0,"a=ssrc:"+a[c]+" cname:"+o),d++),s&&(n.splice(d,0,"a=ssrc:"+a[c]+" msid:"+s),d++),i&&(n.splice(d,0,"a=ssrc:"+a[c]+" mslabel:"+s),d++),u&&(n.splice(d,0,"a=ssrc:"+a[c]+" label:"+s),d++);n.splice(d,0,"a=ssrc-group:SIM "+a[0]+" "+a[1]+" "+a[2]),(e=n.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==adapter.browserDetails.browser&&Janus.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),t.mySdp=e.sdp,t.pc.setLocalDescription(e)),t.iceDone||t.trickle?t.sdpSent?Janus.log("Offer already sent, not sending it again"):(Janus.log("Offer ready"),Janus.debug(r),t.sdpSent=!0,e={type:e.type,sdp:e.sdp},r.success(e)):Janus.log("Waiting for all candidates...")},r.error,e)}function L(e,n,r){(r=r||{}).success="function"==typeof r.success?r.success:Janus.noop,r.error="function"==typeof r.error?r.error:Janus.noop;var a=S[e];if(null==a||null===a.webrtcStuff||void 0===a.webrtcStuff)return Janus.warn("Invalid handle"),void r.error("Invalid handle");var t=a.webrtcStuff,o=!0===r.simulcast;o?Janus.log("Creating answer (iceDone="+t.iceDone+", simulcast="+o+")"):Janus.log("Creating answer (iceDone="+t.iceDone+")");e=null,e="firefox"==Janus.webRTCAdapter.browserDetails.browser||"edge"==Janus.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:B(n),offerToReceiveVideo:z(n)}:{mandatory:{OfferToReceiveAudio:B(n),OfferToReceiveVideo:z(n)}};Janus.debug(e);var s=H(n);s&&o&&"firefox"===adapter.browserDetails.browser&&(Janus.log("Enabling Simulcasting for Firefox (RID)"),a=t.pc.getSenders()[1],Janus.log(a),n=a.getParameters(),Janus.log(n),a.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})),t.pc.createAnswer(function(e){Janus.debug(e),null!==t.mySdp&&void 0!==t.mySdp||(Janus.log("Setting local description"),s&&o&&("chrome"===adapter.browserDetails.browser?Janus.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==adapter.browserDetails.browser&&Janus.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),t.mySdp=e.sdp,t.pc.setLocalDescription(e)),t.iceDone||t.trickle?t.sdpSent?Janus.log("Answer already sent, not sending it again"):(t.sdpSent=!0,e={type:e.type,sdp:e.sdp},r.success(e)):Janus.log("Waiting for all candidates...")},r.error,e)}function N(e){e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),0;var t=e.webrtcStuff;return t.pc.getStats&&"chrome"==Janus.webRTCAdapter.browserDetails.browser?null===t.remoteStream||void 0===t.remoteStream?(Janus.warn("Remote stream unavailable"),0):null===t.volume.timer||void 0===t.volume.timer?(Janus.log("Starting volume monitor"),t.volume.timer=setInterval(function(){t.pc.getStats(function(e){for(var n=e.result(),r=0;r<n.length;r++){var a=n[r];"ssrc"==a.type&&a.stat("audioOutputLevel")&&(t.volume.value=a.stat("audioOutputLevel"))}})},200),0):t.volume.value:(Janus.log("Getting the remote volume unsupported by browser"),0)}function U(e,n){e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),!0;e=e.webrtcStuff;return null===e.pc||void 0===e.pc?(Janus.warn("Invalid PeerConnection"),!0):void 0===e.myStream||null===e.myStream?(Janus.warn("Invalid local MediaStream"),!0):n?null===e.myStream.getVideoTracks()||void 0===e.myStream.getVideoTracks()||0===e.myStream.getVideoTracks().length?(Janus.warn("No video track"),!0):!e.myStream.getVideoTracks()[0].enabled:null===e.myStream.getAudioTracks()||void 0===e.myStream.getAudioTracks()||0===e.myStream.getAudioTracks().length?(Janus.warn("No audio track"),!0):!e.myStream.getAudioTracks()[0].enabled}function V(e,n,r){e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),!1;e=e.webrtcStuff;return null===e.pc||void 0===e.pc?(Janus.warn("Invalid PeerConnection"),!1):void 0===e.myStream||null===e.myStream?(Janus.warn("Invalid local MediaStream"),!1):n?null===e.myStream.getVideoTracks()||void 0===e.myStream.getVideoTracks()||0===e.myStream.getVideoTracks().length?(Janus.warn("No video track"),!1):(e.myStream.getVideoTracks()[0].enabled=!r,!0):null===e.myStream.getAudioTracks()||void 0===e.myStream.getAudioTracks()||0===e.myStream.getAudioTracks().length?(Janus.warn("No audio track"),!1):(e.myStream.getAudioTracks()[0].enabled=!r,!0)}function W(e){e=S[e];if(null==e||null===e.webrtcStuff||void 0===e.webrtcStuff)return Janus.warn("Invalid handle"),"Invalid handle";var r=e.webrtcStuff;return null===r.pc||void 0===r.pc?"Invalid PeerConnection":r.pc.getStats?null===r.bitrate.timer||void 0===r.bitrate.timer?(Janus.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval(function(){r.pc.getStats().then(function(e){e.forEach(function(e){var n;e&&(n=!1,(n=("video"===e.mediaType||-1<e.id.toLowerCase().indexOf("video"))&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0||"ssrc"==e.type&&e.bytesReceived&&("VP8"===e.googCodecName||""===e.googCodecName)?!0:n)&&(r.bitrate.bsnow=e.bytesReceived,r.bitrate.tsnow=e.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore||(e=r.bitrate.tsnow-r.bitrate.tsbefore,"safari"==adapter.browserDetails.browser&&(e/=1e3),e=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/e),r.bitrate.value=e+" kbits/sec"),r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow))})})},1e3),"0 kbits/sec"):r.bitrate.value:(Janus.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function q(e){Janus.error("WebRTC error:",e)}function _(e,n){Janus.log("Cleaning WebRTC stuff");var r=S[e];if(null!=r){var a=r.webrtcStuff;if(null!=a){!0===n&&(n={janus:"hangup",transaction:Janus.randomString(12)},null!=J&&(n.token=J),null!=w&&(n.apisecret=w),Janus.debug("Sending hangup request (handle="+e+"):"),Janus.debug(n),i?(n.session_id=y,n.handle_id=e,u.send(JSON.stringify(n))):Janus.httpAPICall(f+"/"+y+"/"+e,{verb:"POST",withCredentials:b,data:n})),a.remoteStream=null,a.volume.timer&&clearInterval(a.volume.timer),a.volume.value=null,a.bitrate.timer&&clearInterval(a.bitrate.timer),a.bitrate.timer=null,a.bitrate.bsnow=null,a.bitrate.bsbefore=null,a.bitrate.tsnow=null,a.bitrate.tsbefore=null,a.bitrate.value=null;try{if(!a.streamExternal&&null!==a.myStream&&void 0!==a.myStream){Janus.log("Stopping local stream tracks");var t,o=a.myStream.getTracks();for(t in o){var s=o[t];Janus.log(s),null!=s&&s.stop()}}}catch(e){}a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(e){}a.pc=null,a.mySdp=null,a.iceDone=!1,a.sdpSent=!1,a.dataChannel=null,a.dtmfSender=null}r.oncleanup()}}function G(e){return Janus.debug("isAudioSendEnabled:",e),null==e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function B(e){return Janus.debug("isAudioRecvEnabled:",e),null==e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function H(e){return Janus.debug("isVideoSendEnabled:",e),null==e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function z(e){return Janus.debug("isVideoRecvEnabled:",e),null==e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}!function r(a){var e=Janus.randomString(12);var n={janus:"create",transaction:e};null!=J&&(n.token=J);null!=w&&(n.apisecret=w);null===f&&Janus.isArray(o)&&(0===(f=o[l]).indexOf("ws")?(i=!0,Janus.log("Server #"+(l+1)+": trying WebSockets to contact Janus ("+f+")")):(i=!1,Janus.log("Server #"+(l+1)+": trying REST API to contact Janus ("+f+")")));if(i){for(var t in u=Janus.newWebSocket(f,"janus-protocol"),d={error:function(){if(Janus.error("Error connecting to the Janus WebSockets server... "+f),Janus.isArray(o))return++l==o.length?void a.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(f=null,void setTimeout(function(){r(a)},200));a.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){T[e]=function(e){if(Janus.debug(e),"success"!==e.janus)return Janus.error("Ooops: "+e.error.code+" "+e.error.reason),void a.error(e.error.reason);c=setTimeout(A,3e4),h=!0,y=e.data.id,Janus.log("Created session: "+y),Janus.sessions[y]=k,a.success()},u.send(JSON.stringify(n))},message:function(e){I(JSON.parse(e.data))},close:function(){null!==f&&h&&s.error("Lost connection to the gateway (is it down?)")}})u.addEventListener(t,d[t]);return}Janus.httpAPICall(f,{verb:"POST",withCredentials:b,body:n,success:function(e){if(Janus.debug(e),"success"!==e.janus)return Janus.error("Ooops: "+e.error.code+" "+e.error.reason),void a.error(e.error.reason);h=!0,y=e.data.id,Janus.log("Created session: "+y),Janus.sessions[y]=k,C(),a.success()},error:function(e,n){if(Janus.error(e+": "+n),Janus.isArray(o))return++l==o.length?void a.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(f=null,void setTimeout(function(){r(a)},200));""===n?a.error(e+": Is the gateway down?"):a.error(e+": "+n)}})}(s),this.getServer=function(){return f},this.isConnected=function(){return h},this.getSessionId=function(){return y},this.destroy=function(e){!function(r){(r=r||{}).success="function"==typeof r.success?r.success:Janus.noop;var e=!0;if(void 0!==r.asyncRequest&&null!==r.asyncRequest&&(e=!0===r.asyncRequest),Janus.log("Destroying session "+y+" (async="+e+")"),!h)return Janus.warn("Is the gateway down? (connected=false)"),r.success();if(null==y)return Janus.warn("No session to destroy"),r.success(),s.destroyed();delete Janus.sessions[y];var n={janus:"destroy",transaction:Janus.randomString(12)};if(null!=J&&(n.token=J),null!=w&&(n.apisecret=w),i){n.session_id=y;function a(){for(var e in d)u.removeEventListener(e,d[e]);u.removeEventListener("message",t),u.removeEventListener("error",o),c&&clearTimeout(c)}var t=function(e){e=JSON.parse(e.data);e.session_id==n.session_id&&e.transaction==n.transaction&&(a(),r.success(),s.destroyed())},o=function(e){a(),r.error("Failed to destroy the gateway: Is the gateway down?"),s.destroyed()};return u.addEventListener("message",t),u.addEventListener("error",o),u.send(JSON.stringify(n))}console.log(resuest,"request====================="),Janus.httpAPICall(f+"/"+y,{verb:"POST",async:e,withCredentials:b,body:n,success:function(e){Janus.log("Destroyed session:"),Janus.debug(e),y=null,h=!1,"success"!==e.janus&&Janus.error("Ooops: "+e.error.code+" "+e.error.reason),r.success(),s.destroyed()},error:function(e,n){Janus.error(e+": "+n),y=null,h=!1,r.success(),s.destroyed()}})}(e)},this.attach=function(e){!function(r){if((r=r||{}).success="function"==typeof r.success?r.success:Janus.noop,r.error="function"==typeof r.error?r.error:Janus.noop,r.consentDialog="function"==typeof r.consentDialog?r.consentDialog:Janus.noop,r.iceState="function"==typeof r.iceState?r.iceState:Janus.noop,r.mediaState="function"==typeof r.mediaState?r.mediaState:Janus.noop,r.webrtcState="function"==typeof r.webrtcState?r.webrtcState:Janus.noop,r.slowLink="function"==typeof r.slowLink?r.slowLink:Janus.noop,r.onmessage="function"==typeof r.onmessage?r.onmessage:Janus.noop,r.onlocalstream="function"==typeof r.onlocalstream?r.onlocalstream:Janus.noop,r.onremotestream="function"==typeof r.onremotestream?r.onremotestream:Janus.noop,r.ondata="function"==typeof r.ondata?r.ondata:Janus.noop,r.ondataopen="function"==typeof r.ondataopen?r.ondataopen:Janus.noop,r.oncleanup="function"==typeof r.oncleanup?r.oncleanup:Janus.noop,r.ondetached="function"==typeof r.ondetached?r.ondetached:Janus.noop,!h)return Janus.warn("Is the gateway down? (connected=false)"),r.error("Is the gateway down? (connected=false)");var a=r.plugin;if(null==a)return Janus.error("Invalid plugin"),r.error("Invalid plugin");var e=r.opaqueId,n=Janus.randomString(12),e={janus:"attach",plugin:a,opaque_id:e,transaction:n};if(null!=J&&(e.token=J),null!=w&&(e.apisecret=w),"chrome"!=adapter.browserDetails.browser&&"firefox"!=adapter.browserDetails.browser&&"safari"!=adapter.browserDetails.browser||(e["force-bundle"]=!0,e["force-rtcp-mux"]=!0),i)return T[n]=function(e){if(Janus.debug(e),"success"!==e.janus)return Janus.error("Ooops: "+e.error.code+" "+e.error.reason),void r.error("Ooops: "+e.error.code+" "+e.error.reason);var n=e.data.id;Janus.log("Created handle: "+n);e={session:k,plugin:a,id:n,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return N(n)},isAudioMuted:function(){return U(n,!1)},muteAudio:function(){return V(n,!1,!0)},unmuteAudio:function(){return V(n,!1,!1)},isVideoMuted:function(){return U(n,!0)},muteVideo:function(){return V(n,!0,!0)},unmuteVideo:function(){return V(n,!0,!1)},getBitrate:function(){return W(n)},send:function(e){t(n,e)},data:function(e){x(n,e)},dtmf:function(e){O(n,e)},consentDialog:r.consentDialog,iceState:r.iceState,mediaState:r.mediaState,webrtcState:r.webrtcState,slowLink:r.slowLink,onmessage:r.onmessage,createOffer:function(e){P(n,e)},createAnswer:function(e){P(n,e)},handleRemoteJsep:function(e){E(n,e)},onlocalstream:r.onlocalstream,onremotestream:r.onremotestream,ondata:r.ondata,ondataopen:r.ondataopen,oncleanup:r.oncleanup,ondetached:r.ondetached,hangup:function(e){_(n,!0===e)},detach:function(e){j(n,e)}};S[n]=e,r.success(e)},e.session_id=y,u.send(JSON.stringify(e));Janus.httpAPICall(f+"/"+y,{verb:"POST",withCredentials:b,body:e,success:function(e){if(Janus.debug(e),"success"!==e.janus)return Janus.error("Ooops: "+e.error.code+" "+e.error.reason),void r.error("Ooops: "+e.error.code+" "+e.error.reason);var n=e.data.id;Janus.log("Created handle: "+n);e={session:k,plugin:a,id:n,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return N(n)},isAudioMuted:function(){return U(n,!1)},muteAudio:function(){return V(n,!1,!0)},unmuteAudio:function(){return V(n,!1,!1)},isVideoMuted:function(){return U(n,!0)},muteVideo:function(){return V(n,!0,!0)},unmuteVideo:function(){return V(n,!0,!1)},getBitrate:function(){return W(n)},send:function(e){t(n,e)},data:function(e){x(n,e)},dtmf:function(e){O(n,e)},consentDialog:r.consentDialog,iceState:r.iceState,mediaState:r.mediaState,webrtcState:r.webrtcState,slowLink:r.slowLink,onmessage:r.onmessage,createOffer:function(e){P(n,e)},createAnswer:function(e){P(n,e)},handleRemoteJsep:function(e){E(n,e)},onlocalstream:r.onlocalstream,onremotestream:r.onremotestream,ondata:r.ondata,ondataopen:r.ondataopen,oncleanup:r.oncleanup,ondetached:r.ondetached,hangup:function(e){_(n,!0===e)},detach:function(e){j(n,e)}};S[n]=e,r.success(e)},error:function(e,n){Janus.error(e+": "+n)}})}(e)}}Janus.sessions={},Janus.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",Janus.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),26<=e&&e<=n||Janus.checkJanusExtension()}return!0},Janus.useDefaultDependencies=function(e){var r=e&&e.fetch||fetch,t=e&&e.Promise||Promise,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new a(e,n)},isArray:function(e){return Array.isArray(e)},checkJanusExtension:function(){return null!==document.querySelector("#janus-extension-installed")},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var n={method:a.verb,cache:"no-cache"};void 0!==a.withCredentials&&(n.credentials=!0===a.withCredentials?"include":a.withCredentials||"omit"),void 0!==a.body&&(n.body=JSON.stringify(a.body));e=r(e,n).catch(function(e){return t.reject({message:"Probably a network error, is the gateway down?",error:e})});return void 0!==a.timeout&&(n=new t(function(e,n){var r=setTimeout(function(){return clearTimeout(r),n({message:"Request timed out",timeout:a.timeout})},a.timeout)}),e=t.race([e,n])),e.then(function(n){return n.ok?typeof a.success==typeof Janus.noop?n.json().then(function(e){a.success(e)}).catch(function(e){return t.reject({message:"Failed to parse response body",error:e,response:n})}):void 0:t.reject({message:"API call failed",response:n})}).catch(function(e){typeof a.error==typeof Janus.noop&&a.error(e.message||"<< internal error >>",e)}),e}}},Janus.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new r(e,n)},isArray:function(e){return t.isArray(e)},checkJanusExtension:function(){return 0<t("#janus-extension-installed").length},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var n=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},r=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(n,r,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success==typeof Janus.noop&&a.success(e)},error:function(e,n,r){typeof a.error==typeof Janus.noop&&a.error(n,r)}}))}}},Janus.noop=function(){},Janus.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:Janus.noop,!0===Janus.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),Janus.trace=Janus.noop,Janus.debug=Janus.noop,Janus.vdebug=Janus.noop,Janus.log=Janus.noop,Janus.warn=Janus.noop,Janus.error=Janus.noop,!0===e.debug||"all"===e.debug)Janus.trace=console.trace.bind(console),Janus.debug=console.debug.bind(console),Janus.vdebug=console.debug.bind(console),Janus.log=console.log.bind(console),Janus.warn=console.warn.bind(console),Janus.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var n in e.debug){var r=e.debug[n];switch(r){case"trace":Janus.trace=console.trace.bind(console);break;case"debug":Janus.debug=console.debug.bind(console);break;case"vdebug":Janus.vdebug=console.debug.bind(console);break;case"log":Janus.log=console.log.bind(console);break;case"warn":Janus.warn=console.warn.bind(console);break;case"error":Janus.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}Janus.log("Initializing library");var a=e.dependencies||Janus.useDefaultDependencies();Janus.isArray=a.isArray,Janus.webRTCAdapter=a.webRTCAdapter,Janus.httpAPICall=a.httpAPICall,Janus.checkJanusExtension=a.checkJanusExtension,Janus.newWebSocket=a.newWebSocket,Janus.listDevices=function(o,e){o="function"==typeof o?o:Janus.noop,null==e&&(e={audio:!0,video:!0}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(e).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(e){Janus.debug(e),o(e);try{var n,r=t.getTracks();for(n in r){var a=r[n];null!=a&&a.stop()}}catch(e){}})}).catch(function(e){Janus.error(e),o([])}):(Janus.warn("navigator.mediaDevices unavailable"),o([]))},Janus.attachMediaStream=function(e,n){"chrome"!==Janus.webRTCAdapter.browserDetails.browser||43<=Janus.webRTCAdapter.browserDetails.version?e.srcObject=n:void 0!==e.src?e.src=URL.createObjectURL(n):Janus.error("Error attaching stream to element")},Janus.reattachMediaStream=function(e,n){"chrome"!==Janus.webRTCAdapter.browserDetails.browser||43<=Janus.webRTCAdapter.browserDetails.version?e.srcObject=n.srcObject:void 0!==e.src?e.src=n.src:Janus.error("Error reattaching stream to element")};var t=window.onbeforeunload;window.onbeforeunload=function(){for(var e in Janus.log("Closing window"),Janus.sessions)null!==Janus.sessions[e]&&void 0!==Janus.sessions[e]&&Janus.sessions[e].destroyOnUnload&&(Janus.log("Destroying session "+e),Janus.sessions[e].destroy({asyncRequest:!1}));t&&"function"==typeof t&&t()},Janus.initDone=!0,e.callback()}},Janus.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},Janus.randomString=function(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",a=0;a<e;a++){var t=Math.floor(Math.random()*n.length);r+=n.substring(t,t+1)}return r};