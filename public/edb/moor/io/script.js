moor.provide("moor.io.script"),function(){var loadEvent=moor.isIE?"onreadystatechange":"load",readyRegExp=/complete|loaded/;moor.io.script={get:function(r){var e,o,t=this._makeScriptDeferred(r),i=t.ioArgs;return moor._ioAddQueryToUrl(i),moor._ioNotifyStart(t),this._canAttach(i)&&(e=this.attach(i.id,i.url,r.frameDoc),i.jsonp||i.args.checkString||(o=moor.connect(e,loadEvent,function(r){"load"!=r.type&&!readyRegExp.test(e.readyState)||(moor.disconnect(o),i.scriptLoaded=r)}))),moor._ioWatch(t,this._validCheck,this._ioCheck,this._resHandle),t},attach:function(r,e,o){var t=o||moor.doc,o=t.createElement("script");return o.type="text/javascript",o.src=e,o.id=r,o.charset="utf-8",t.getElementsByTagName("head")[0].appendChild(o)},remove:function(r,e){moor.destroy(moor.byId(r,e)),this["jsonp_"+r]&&delete this["jsonp_"+r]},_makeScriptDeferred:function(r){var e=moor._ioSetArgs(r,this._deferredCancel,this._deferredOk,this._deferredError),o=e.ioArgs;return o.id=moor._scopeName+"IoScript"+this._counter++,o.canDelete=!1,o.jsonp=r.callbackParamName||r.jsonp,o.jsonp&&(o.query=o.query||"",0<o.query.length&&(o.query+="&"),o.query+=o.jsonp+"="+(r.frameDoc?"parent.":"")+moor._scopeName+".io.script.jsonp_"+o.id+"._jsonpCallback",o.frameDoc=r.frameDoc,o.canDelete=!0,e._jsonpCallback=this._jsonpCallback,this["jsonp_"+o.id]=e),e},_deferredCancel:function(r){r.canceled=!0,r.ioArgs.canDelete&&moor.io.script._addDeadScript(r.ioArgs)},_deferredOk:function(r){r=r.ioArgs;return r.canDelete&&moor.io.script._addDeadScript(r),r.json||r.scriptLoaded||r},_deferredError:function(r,e){return e.ioArgs.canDelete&&("timeout"==r.dojoType?moor.io.script.remove(e.ioArgs.id,e.ioArgs.frameDoc):moor.io.script._addDeadScript(e.ioArgs)),console.log("moor.io.script error",r),r},_deadScripts:[],_counter:1,_addDeadScript:function(r){moor.io.script._deadScripts.push({id:r.id,frameDoc:r.frameDoc}),r.frameDoc=null},_validCheck:function(r){var e=moor.io.script,o=e._deadScripts;if(o&&0<o.length){for(var t=0;t<o.length;t++)e.remove(o[t].id,o[t].frameDoc),o[t].frameDoc=null;moor.io.script._deadScripts=[]}return!0},_ioCheck:function(dfd){var ioArgs=dfd.ioArgs;if(ioArgs.json||ioArgs.scriptLoaded&&!ioArgs.args.checkString)return!0;var checkString=ioArgs.args.checkString;return checkString&&eval("typeof("+checkString+") != 'undefined'")?!0:!1},_resHandle:function(r){moor.io.script._ioCheck(r)?r.callback(r):r.errback(new Error("inconceivable moor.io.script._resHandle error"))},_canAttach:function(r){return!0},_jsonpCallback:function(r){this.ioArgs.json=r}}}();